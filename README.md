# Carrot Market Reloaded

# 1 â¤ï¸ ANNOUNCEMENT

## 1.1 ğŸš¨ Read this First ğŸš¨

## 1.2 Thank You!

## 1.3 ğŸ”” NextJS Quiz ğŸ””

https://docs.google.com/forms/d/e/1FAIpQLSee9TXmr6qVsCMlrgO2lj0paJ5pXNKH9NSsPhZmah5d-VxmCA/viewscore?pli=1&viewscore=AE0zAgCMEFnFg55ttlgwlehrRNDYDg9RqoxZfTXiJF0yciQ1iOoxLg-NcJGTyRPn3Vtwwoc

# 2 INTRODUCTION

2ì›” 6ì¼ ê°•ì˜ ë…¹í™” ì‹œì‘

## 2.0 Welcome

ìœ ì €ì—ê²Œ ì‹¤ì œë¡œ ì–´ë–»ê²Œ ë³´ì¼ì§€ ë§Œë“¤ì–´ë³´ëŠ” ê°•ì˜

í† ì´ í”„ë¡œì íŠ¸ ë§ê³ , ì‹¤ì œ ì œí’ˆì„ ë§Œë“¤ì–´ë³´ë©´ ë” ë°°ìš°ëŠ”ê²Œ ë§ì•„ìš”. ê·¸ë¦¬ê³  í”„ë ˆì„ì›Œí¬ê°€ ì´ëŸ° ê¸°ëŠ¥ì„ ì™œ ì œê³µí•˜ëŠ”ì§€ë„ ì•Œ ìˆ˜ ìˆê²Œ ë˜ìš”.

Next.jsë„ ë¶ˆí¸í•œ ê²ƒì´ ìˆì–´ì„œ ì´ê±¸ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•´ì„œ í•´ê²°í•´ ë³´ê¸°ë„ í• ê±°ì—ìš”.

ë¬´ì—‡ì´ë“  êµ¬í˜„í•  ìˆ˜ ìˆë‹¤ëŠ” ìì‹ ê°!

## 2.1 Requirements

https://nomadocders.co/nextjs-for-beginners/

## 2.2 What Are We Using

- Next.js
- Prisma
- PlanetScale
- Vercel
- Cloudflare
  - Cloudflare Images
  - Cloudflare stream
  - Cloudflare workers

## 2.3 Learning Rate

ë°°ìš°ëŠ” ì‹œê°„ì€ ì„ í˜•ì…ë‹ˆë‹¤.

ì¸ì¦, ì´ë¯¸ì§€ê¹Œì§€ëŠ” ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. ê·¸ ì´í›„ëŠ” ì­‰ì­‰ ë‚˜ê°ˆê²ë‹ˆë‹¤.

## 2.4 How To Get Help

1. ëŒ“ê¸€
   1. ì‘ë™, ê°œë… ì§ˆë¬¸
2. Issues
   1. ë­”ê°€ ì´ìƒí•¨, ì—ëŸ¬2

## 2.5 Project Setup

Git Providerë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” GitHub ì‚¬ìš©!

https://nextjs.org/docs/app/api-reference/create-next-app

https://nextjs.org/docs/pages/api-reference/create-next-app

```bash
npx create-next-app@latest
```

TypeScriptë¥¼ ì”ì‹œë‹¤!

```
Yes Yes Yes No Yes No
```

# 3 TAILWIND

## 3.0 Introduction

ë””ìì´ë„ˆ ì—†ì´ ë©‹ì§„ CSSë¥¼ ë¹ ë¥´ê²Œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ CSS Frameworkë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ ì¤‘ ë©‹ì§€ê³  ë©‹ì§„ Tailwind CSSë¥¼ ë°°ì›Œë´…ì‹œë‹¤.

Utility FirstëŠ” ì§§ì€ class nameì´ ì—„ì²­ ë§ë‹¤.

Bootstrap, Foundationì€ ê¸°ë³¸ì ì¸ UIë¥¼ ì œê³µí•´ì„œ ë¹„ìŠ·ë¹„ìŠ·í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ Tailwind CSSëŠ” ì•„ë¬´ê²ƒë„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì§ì ‘ classë¥¼ ë§Œë“¤ë ¤ë¨¼ class ì´ë¦„ë„ ê³ ë¯¼í•´ì•¼í•˜ê³ , ê°’ë„ ê³ ë¯¼í•´ì•¼ í•©ë‹ˆë‹¤.

Tailwind CSSë¥¼ ì§ì ‘ ë§Œë“  ì‚¬ëŒë„, CSSì™€ Markupì„ ì„ë‹¤ë‹ˆ!!! ë‚œë¦¬ë‚  ê²ƒì„ ì•Œì•˜ì§€ë§Œ, ê·¸ë˜ë„ í•œ ë²ˆ ì¨ë³´ë¼ê³  í–ˆë‹¤.

ë°˜ì‘í˜•, ë‹¤í¬ëª¨ë“œ ë“±ë“± ë‹¤ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ë§ì€ íšŒì‚¬ë“¤ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.

## 3.1 IntelliSense

ê°„ë‹¨í•œ ê²ƒë“¤ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

Visual Studio Code Extension, Tailwind CSS IntelliSense ì„¤ì¹˜

ê·¸ëŸ¬ë©´ ì´ Extensionì´ tailwind.config.tsë¥¼ í™•ì¸

Auto complete: option + esc

## 3.2 Card Component

1 container + 4 row + each column

```tsx
export default function Home() {
  return (
    <main>
      <div>
        <div>
          <div>
            <span>In transit</span>
            <span>Coolblue</span>
          </div>
          <div />
        </div>
        <div>
          <span>Time</span>
          <span>9:30-10:30</span>
        </div>
        <div>
          <div />
          <div />
        </div>
        <div>
          <span>Expected</span>
          <span>Sorting center</span>
          <span>In transit</span>
          <span>Delivered</span>
        </div>
      </div>
    </main>
  );
}
```

ì‘ì—… í›„

```tsx
export default function Home() {
  return (
    <main className="bg-gray-300 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-2xl w-full">
        <div className="flex justify-between items-center">
          <div className="flex flex-col">
            <span className="text-gray-600 font-semibold -mb-1">
              In transit
            </span>
            <span className="text-4xl font-semibold">Coolblue</span>
          </div>
          <div className="size-12 rounded-full bg-orange-400" />
        </div>
        <div className="my-2 flex items-center gap-2">
          <span className="bg-green-400 text-white uppercase px-2.5 py-1.5 text-xs font-medium rounded-full ">
            Today
          </span>
          <span>9:30-10:30</span>
        </div>
        <div className="relative">
          <div className="bg-gray-200 absolute rounded-full w-full h-2" />
          <div className="bg-green-400 absolute rounded-full w-2/3 h-2" />
        </div>
        <div className="flex justify-between items-center mt-5 text-gray-600">
          <span>Expected</span>
          <span>Sorting center</span>
          <span>In transit</span>
          <span className="text-gray-400">Delivered</span>
        </div>
      </div>
    </main>
  );
}
```

## 3.3 Modifiers

modifierëŠ” Styleì„ ì¡°ê±´ë¶€ë¡œ ì ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ

modifierëŠ” ì‹œì‘ì„ í•­ìƒ : ìœ¼ë¡œ í•©ë‹ˆë‹¤.

Dark Mode

hover over

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 h-screen flex items-center justify-center p-5 dark:bg-gray-700">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm dark:bg-gray-600">
        <div className="flex justify-between items-center">
          <div className="flex flex-col">
            <span className="text-gray-600 font-semibold -mb-1 dark:text-gray-300">
              In transit
            </span>
            <span className="text-4xl font-semibold dark:text-white">
              Coolblue
            </span>
          </div>
          <div className="size-12 rounded-full bg-orange-400" />
        </div>
        <div className="my-2 flex items-center gap-2">
          <span className="bg-green-400 text-white uppercase px-2.5 py-1.5 text-xs font-medium rounded-full transition hover:bg-green-500 hover:scale-125">
            Today
          </span>
          <span className="dark:text-gray-100">9:30-10:30</span>
        </div>
        <div className="relative">
          <div className="bg-gray-200 absolute rounded-full w-full h-2" />
          <div className="bg-green-400 absolute rounded-full w-2/3 h-2" />
        </div>
        <div className="flex justify-between items-center mt-5 text-gray-600 dark:text-gray-300 ">
          <span>Expected</span>
          <span>Sorting center</span>
          <span>In transit</span>
          <span className="text-gray-400 dark:text-gray-500">Delivered</span>
        </div>
      </div>
    </main>
  );
}
```

## 3.4 Tailwind Variables

ring, â€”tw-ring-offset-shadow, â€”tw-ring-shadow

ê°€ë” ringì²˜ëŸ¼ ì—¬ëŸ¬ ë³€ìˆ˜ë¥¼ í•„ìš”ë¡œí•˜ëŠ” ì†ì„±ì„ ë§Œë‚˜ê²Œ ë  ê±°ì—ìš”.

bg-blackì—ëŠ” â€”tw-bg-opacityê°€ ìˆëŠ”ë°ìš” bg-opacityë¥¼ ì„¤ì •í•˜ë©´ CSSëŠ” ë°”ê¾¸ì§€ ì•Šì§€ë§Œ ë³€ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col gap-2">
        <input
          className="w-full rounded-full h-10 bg-gray-200 pl-5 focus:outline-none ring ring-transparent focus:ring-orange-500 focus:ring-offset-2 transition-shadow placeholder:text-red-600 placeholder:drop-shadow"
          type="text"
          placeholder="Search here..."
        />
        <button className="bg-black text-white py-2 rounded-full active:scale-90 transition-transform font-medium  outline-none">
          Search
        </button>
      </div>
    </main>
  );
}
```

## 3.5 Responsive Modifiers

ë‹¤í¬ëª¨ë“œ ë”¸ê¹

Tailwind CSSëŠ” ëª¨ë°”ì¼ì´ ìš°ì„ ì´ë‹¤. ê·¸ë˜ì„œ ë” í° í™”ë©´ì— ì‚¬ìš©í•˜ëŠ” modifierê°€ ì¡´ì¬.

Tailwindì—ì„œëŠ” ë°˜ëŒ€ë¡œ ëª¨ë°”ì¼ë¶€í„° í•˜ê³  ë°ìŠ¤í¬íƒ‘ì„ ê¾¸ë°‰ë‹ˆë‹¤.

https://tailwindcss.com/docs/containerì— sm, md, lg, xl, 2xlì— ëŒ€í•œ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤.

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 sm:bg-red-100 md:bg-green-100 lg:bg-cyan-100 xl:bg-orange-100 2xl:bg-purple-100 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col md:flex-row gap-2">
        <input
          className="w-full rounded-full h-10 bg-gray-200 pl-5 outline-none ring ring-transparent focus:ring-orange-500 focus:ring-offset-2 transition-shadow placeholder:drop-shadow"
          type="text"
          placeholder="Search here..."
        />
        <button className="bg-black text-white py-2 rounded-full active:scale-90  transition-transform font-medium outline-none md:px-10 ">
          Search
        </button>
      </div>
    </main>
  );
}
```

## 3.6 Form Modifiers

- bg-gradient-to-tr from-cyan-500 to-purple-400
- https://tailwindcss.com/docs/gradient-color-stops
- invalid:
- https://tailwindcss.com/docs/hover-focus-and-other-states#invalid
- invalid:form: ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- peerëŠ” ë¶€ëª¨ì— ì„ ì–¸, ìì‹ì—ì„œ ì„¤ì •
- https://tailwindcss.com/docs/hover-focus-and-other-states#styling-based-on-sibling-state
- hidden
  - display: none

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 sm:bg-red-100 md:bg-green-100 lg:bg-cyan-100 xl:bg-orange-100 2xl:bg-purple-100 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col md:flex-row gap-2">
        <input
          className="w-full rounded-full h-10 bg-gray-200 pl-5 outline-none ring ring-transparent focus:ring-green-500 focus:ring-offset-2 transition-shadow placeholder:drop-shadow invalid:focus:ring-red-500 peer"
          type="email"
          required
          placeholder="Email address"
        />
        <span className="text-red-500 font-medium hidden peer-invalid:block ">
          Email is required.
        </span>
        <button className="text-white py-2 rounded-full active:scale-90  transition-transform font-medium outline-none md:px-10 bg-black ">
          Log in
        </button>
      </div>
    </main>
  );
}
```

## 3.7 State Modifiers

\*: outline-none â†’ ìì‹ì— ëª¨ë‘ ì ìš©!

https://tailwindcss.com/docs/hover-focus-and-other-states#styling-direct-children

has-[.peer]:bg-green-100 â†’

https://tailwindcss.com/docs/hover-focus-and-other-states#styling-based-on-descendants

hasëŠ” CSSì˜ ê°€ìƒ í´ë˜ìŠ¤

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 sm:bg-red-100 md:bg-green-100 lg:bg-cyan-100 xl:bg-orange-100 2xl:bg-purple-100 h-screen flex items-center justify-center p-5">
      <div
        className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col md:flex-row gap-2 *:outline-none ring ring-transparent transition-shadow
      has-[:invalid]:ring-red-100"
      >
        <input
          className="w-full rounded-full h-10 bg-gray-200 pl-5 ring ring-transparent focus:ring-green-500 focus:ring-offset-2 transition-shadow placeholder:drop-shadow invalid:focus:ring-red-500 peer"
          type="text"
          required
          placeholder="Email address"
        />
        <span className="text-red-500 font-medium hidden peer-invalid:block ">
          Email is required.
        </span>
        <button className="text-white py-2 rounded-full active:scale-90  transition-transform font-medium  md:px-10 bg-black ">
          Log in
        </button>
      </div>
    </main>
  );
}
```

## 3.8 Lists and Animations

- odd:
- even:
- first:
- last:
- animation-bounce
- animation-spin ë¡œë”©ì— ì‚¬ìš©ë¨
- animation-pulse ë¡œë”©ì— ì‚¬ìš©ë¨, ìŠ¤ì¼ˆë ˆí†¤ + double background
- empty:

```
export default function Home() {
  return (
    <main className="bg-gray-100 sm:bg-red-100 md:bg-green-100 lg:bg-cyan-100 xl:bg-orange-100 2xl:bg-purple-100 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col gap-4">
        {["Nico", "Me", "You", "Yourself", ""].map((person, index) => (
          <div key={index} className="flex items-center gap-5">
            <div className="size-10 bg-blue-400 rounded-full" />
            <span className="text-lg font-medium empty:w-24 empty:h-5 empty:rounded-full empty:animate-pulse empty:bg-gray-300">
              {person}
            </span>
            <div className="size-6 bg-red-500 text-white flex items-center justify-center rounded-full relative">
              <span className="z-10">{index}</span>
              <div className="size-6 bg-red-500 rounded-full absolute animate-ping " />
            </div>
          </div>
        ))}
      </div>
    </main>
  );
}

```

## 3.9 Group Modifiers

ì§€ê¸ˆê¹Œì§€ëŠ” ìì‹ì˜ ìƒíƒœê°€ ë°”ë€Œë©´ ë¶€ëª¨ ì»¨í…Œì´ë„ˆë¥¼ ë°”ê¾¸ëŠ” ê±¸ ë°°ì›Œë´¤ìŠµë‹ˆë‹¤.

ì´ì   ë¶€ëª¨ì˜ stateê°€ ë°”ë€Œì—ˆì„ ë•Œ!!! ìì‹ì„ ë°”ê¾¸ê²Œ í•˜ëŠ”ê²Œ Group modifier

```tsx
<div className="group">
  <div className="group-hover: text-red-500"></div>
</div>
```

- group-hover
- group-require
- group-focus
- group-invalid

```tsx
export default function Home() {
  return (
    <main className="bg-gray-100 sm:bg-red-100 md:bg-green-100 lg:bg-cyan-100 xl:bg-orange-100 2xl:bg-purple-100 h-screen flex items-center justify-center p-5">
      <div className="bg-white shadow-lg p-5 rounded-3xl w-full max-w-screen-sm flex flex-col gap-4">
        <div className="group flex flex-col">
          <input
            className="bg-gray-100 w-full"
            placeholder="Write your email"
          />
          <span className="group-focus-within:block hidden">
            Make sure it is a valid email...
          </span>
          <button>Submit</button>
        </div>
      </div>
    </main>
  );
}
```

## 3.10 JIT

Tailwind CSSê°€ ìˆ˜ë§Œê°€ì§€ CSS classë¥¼ ì¤€ë¹„í•´ ë‘” ê²ƒì´ ì•„ë‹ˆë¼, ìœ ì €ê°€ classNameì„ ì‘ì„±í•˜ë©´ ê±°ê¸°ì— ë§ê²Œ CSSë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.

JIT compilerì…ë‹ˆë‹¤.

arbitrary values, ë¦¬ìŠ¤íŠ¸ì— ì—†ëŠ” ì• ë§¤í•œ ê°’ ì¶”ê°€í•  ë•Œ

```tsx
<div className="h-10" />
<div className="h-[3523.23px]" />
```

ì›í•˜ëŠ” ìƒ‰ìƒ ì¶”ê°€

https://tailwindcss.com/docs/adding-custom-styles

```tsx
<button className="rounded-sexy-name mt-tomato">Submit</button>
```

```tsx
import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      margin: {
        tomato: "120px",
      },
      borderRadius: {
        "sexy-name": "11.11px",
      },
    },
  },
  plugins: [],
};
export default config;
```

## 3.11 Directives

https://tailwindcss.com/docs/functions-and-directives

ìš°ë¦¬ê°€ classNameì— ì¶”ê°€í•œ CSSëŠ” utilities

baseëŠ” resetê³¼ ë¹„ìŠ·

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

componentëŠ”??

@applyëŠ”?? ë¶„ë¦¬ëœ ì»´í¬ë„ŒíŠ¸ë¥¼ ìœ„í•œ ê²ƒ.

```css
.btn {
  @apply w-full bg-black;
}
```

```html
<div className="btn" />
```

@layerëŠ” baseì— ì¶”ê°€í• ë•Œ ì‚¬ìš©

```html
@layer base { a { @apply text-blue-500; } }
```

@tailwind componentëŠ”???

layer, base ë“± baseë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ layerì™€ applyë¥¼ í•œ ê²ƒë“¤ì„ baseëŠ” ë‚´ë²„ë ¤ë‘ê³  componentì—ì„œ í•´ë¼~~

## 3.12 Plugins

componentëŠ” pluginì„ ìœ„í•œ ê²ƒ

npmìœ¼ë¡œ ë‚¨ë“¤ì´ ë§Œë“  pluginì„ ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ex) daisyUI, tailwind CSS Form

## 3.13 Conclusions

ì•ìœ¼ë¡œ ë§Œë“¤ì–´ê°€ë©´ì„œ ë§ì´ ì‚¬ìš©í• ê±°ë¼ ê¸ˆë°© ìµìˆ™í•´ì§ˆ ê²ë‹ˆë‹¤.

# 4 AUTHENTICATION UI

## 4.0 Home Screen

- ë¡œê·¸ì•„ì›ƒ í–ˆì„ ë•Œ í˜ì´ì§€
- ë¡œê·¸ì¸ í˜ì´ì§€
- íšŒì›ê°€ì… í˜ì´ì§€
- SMS ì¸ì¦ ë¡œê·¸ì¸ í˜ì´ì§€

ë§Œë“¤ê²ë‹ˆë‹¤.

ë‹¤í¬ëª¨ë“œë§Œ í•  ê²ë‹ˆë‹¤.

ë°˜ì‘í˜• ë§ì´ ì•ˆí• ê²ë‹ˆë‹¤.

ì œì¼ ë¨¼ì € í™ˆí˜ì´ì§€ë¶€í„° ë§Œë“­ì‹œë‹¤.

- Tailwind CSS
  - underline-offset-4
  - \*:
  - my-auto, mx-auto

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  a {
    @apply text-orange-500;
  }
}
```

```tsx
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${inter.className} bg-neutral-900 text-white max-w-screen-sm mx-auto`}
      >
        {children}
      </body>
    </html>
  );
}
```

```tsx
import Link from "next/link";

export default function Home() {
  return (
    <div className="flex flex-col items-center justify-between min-h-screen p-6">
      <div className="my-auto flex flex-col items-center gap-2 *:font-medium">
        <span className="text-9xl">ğŸ¥•</span>
        <h1 className="text-4xl ">ë‹¹ê·¼</h1>
        <h2 className="text-2xl">ë‹¹ê·¼ ë§ˆê²Ÿì— ì–´ì„œì˜¤ì„¸ìš”!</h2>
      </div>
      <div className="flex flex-col items-center gap-3 w-full">
        <Link
          href="/create-account"
          className="w-full bg-orange-500 text-white text-lg font-medium py-2.5 rounded-md text-center hover:bg-orange-400 transition-colors"
        >
          ì‹œì‘í•˜ê¸°
        </Link>
        <div className="flex gap-2">
          <span>ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”?</span>
          <Link href="/login" className="hover:underline">
            ë¡œê·¸ì¸
          </Link>
        </div>
      </div>
    </div>
  );
}
```

## 4.1 Create Account Screen

íšŒì› ê°€ì… í˜ì´ì§€ ë§Œë“­ì‹œë‹¤.

- ì¸ì‚¬ë§
- formì„ ì‚¬ìš©í•œ ê°€ì…
- SMS ê°€ì…

Tailwind CSS

- ring-1
- ring-2

êµµê¸°ì°¨ì´ ì…ë‹ˆë‹¤.

ê³µí†µ ë¶€ë¶„ componentë¡œ ì˜®ê¸°ê¸°

```css
@layer components {
  .primary-btn {
    @apply w-full bg-orange-500 text-white  font-medium  rounded-md text-center hover:bg-orange-400 transition-colors;
  }
}
```

h-1pxì€ ì—†ê³  h-pxëŠ” ìˆìŠµë‹ˆë‹¤.

```tsx
import { ChatBubbleOvalLeftEllipsisIcon } from "@heroicons/react/24/solid";
import Link from "next/link";

export default function CreateAccount() {
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Fill in the form below to join!</h2>
      </div>
      <form className="flex flex-col gap-3">
        <div className="flex flex-col gap-2">
          <input
            className="bg-transparent rounded-md w-full h-10 focus:outline-none ring-1 focus:ring-2 ring-neutral-200 focus:ring-orange-500 border-none placeholder:text-neutral-400"
            type="text"
            placeholder="Username"
            required
          />
          <span className="text-red-500 font-medium">Input error</span>
        </div>
        <button className="primary-btn h-10">Create account</button>
      </form>
      <div className="w-full h-px bg-neutral-500" />
      <div>
        <Link
          className="primary-btn flex h-10 items-center justify-center gap-2"
          href="/sms"
        >
          <span>
            <ChatBubbleOvalLeftEllipsisIcon className="h-6 w-6" />
          </span>
          <span>Sign up with SMS</span>
        </Link>
      </div>
    </div>
  );
}
```

ì•„ì´ì½˜ë„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

@heroicons/react

https://github.com/tailwindlabs/heroicons

## 4.2 Form Components

typeì´ í•„ìš”í•˜ê¸° ì „ê¹Œì§€ interface ì“°ì„¸ìš”.

- disabled:bg-neutral-400
- disabled:text-neutral-300
- disabled:cursor-not-allowed

ì§€ê¸ˆê¹Œì§€ JavaScript ì‚¬ìš©í•œê±° ì—†ìŠµë‹ˆë‹¤~~

- app/create-account/page.tsx

```tsx
import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";

export default function CreateAccount() {
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Fill in the form below to join!</h2>
      </div>
      <form className="flex flex-col gap-3">
        <FormInput type="text" placeholder="Username" required errors={[]} />
        <FormInput type="email" placeholder="Email" required errors={[]} />
        <FormInput
          type="password"
          placeholder="Password"
          required
          errors={[]}
        />
        <FormInput
          type="password"
          placeholder="Confirm Password"
          required
          errors={[]}
        />
        <FormButton loading={false} text="Create account" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

- components/form-btn.tsx

```tsx
interface FormButtonProps {
  loading: boolean;
  text: string;
}

export default function FormButton({ loading, text }: FormButtonProps) {
  return (
    <button
      disabled={loading}
      className="primary-btn h-10 disabled:bg-neutral-400  disabled:text-neutral-300 disabled:cursor-not-allowed"
    >
      {loading ? "ë¡œë”© ì¤‘" : text}
    </button>
  );
}
```

- components/form-login.tsx

```tsx
interface FormInputProps {
  type: string;
  placeholder: string;
  required: boolean;
  errors: string[];
}

export default function FormInput({
  type,
  placeholder,
  required,
  errors,
}: FormInputProps) {
  return (
    <div className="flex flex-col gap-2">
      <input
        className="bg-transparent rounded-md w-full h-10 focus:outline-none ring-2 focus:ring-4 transition ring-neutral-200 focus:ring-orange-500 border-none placeholder:text-neutral-400"
        type={type}
        placeholder={placeholder}
        required={required}
      />
      {errors.map((error, index) => (
        <span key={index} className="text-red-500 font-medium">
          {error}
        </span>
      ))}
    </div>
  );
}
```

## 4.3 Log in Screen

import alias â†’ @/components/form-btn

```json
    "paths": {
      "@/*": [
        "./*"
      ]
    }
```

GitHub svg icon

- https://www.svgrepo.com/svg/512317/github-142
- https://react-icons.github.io/react-icons/search/#q=github
- https://icons8.com/icons/set/github

íšŒì›ê°€ì… í˜ì´ì§€ë¥¼ ë³µì‚¬í•´ì„œ /login, /smsë„ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

CSSì— ìì‹ ê°ì„ ê°€ì§€ì„¸ìš”!!!

- app/login/page.tsx

```tsx
import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";

export default function LogIn() {
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form className="flex flex-col gap-3">
        <FormInput type="email" placeholder="Email" required errors={[]} />
        <FormInput
          type="password"
          placeholder="Password"
          required
          errors={[]}
        />
        <FormButton loading={false} text="Log in" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

- app/sms/page.tsx

```tsx
import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";

export default function SMSLogin() {
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">SMS Log in</h1>
        <h2 className="text-xl">Verify your phone number.</h2>
      </div>
      <form className="flex flex-col gap-3">
        <FormInput
          type="number"
          placeholder="Phone number"
          required
          errors={[]}
        />
        <FormInput
          type="number"
          placeholder="Verification code"
          required
          errors={[]}
        />
        <FormButton loading={false} text="Verify" />
      </form>
    </div>
  );
}
```

- components/social-login.tsx

```tsx
import { ChatBubbleOvalLeftEllipsisIcon } from "@heroicons/react/24/solid";
import Link from "next/link";

export default function SocialLogin() {
  return (
    <>
      <div className="w-full h-px bg-neutral-500" />
      <div className="flex flex-col gap-3">
        <Link
          className="primary-btn flex h-10 items-center justify-center gap-2"
          href="/github/start"
        >
          <svg
            className="size-6"
            viewBox="0 0 15 15"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M7.49933 0.25C3.49635 0.25 0.25 3.49593 0.25 7.50024C0.25 10.703 2.32715 13.4206 5.2081 14.3797C5.57084 14.446 5.70302 14.2222 5.70302 14.0299C5.70302 13.8576 5.69679 13.4019 5.69323 12.797C3.67661 13.235 3.25112 11.825 3.25112 11.825C2.92132 10.9874 2.44599 10.7644 2.44599 10.7644C1.78773 10.3149 2.49584 10.3238 2.49584 10.3238C3.22353 10.375 3.60629 11.0711 3.60629 11.0711C4.25298 12.1788 5.30335 11.8588 5.71638 11.6732C5.78225 11.205 5.96962 10.8854 6.17658 10.7043C4.56675 10.5209 2.87415 9.89918 2.87415 7.12104C2.87415 6.32925 3.15677 5.68257 3.62053 5.17563C3.54576 4.99226 3.29697 4.25521 3.69174 3.25691C3.69174 3.25691 4.30015 3.06196 5.68522 3.99973C6.26337 3.83906 6.8838 3.75895 7.50022 3.75583C8.1162 3.75895 8.73619 3.83906 9.31523 3.99973C10.6994 3.06196 11.3069 3.25691 11.3069 3.25691C11.7026 4.25521 11.4538 4.99226 11.3795 5.17563C11.8441 5.68257 12.1245 6.32925 12.1245 7.12104C12.1245 9.9063 10.4292 10.5192 8.81452 10.6985C9.07444 10.9224 9.30633 11.3648 9.30633 12.0413C9.30633 13.0102 9.29742 13.7922 9.29742 14.0299C9.29742 14.2239 9.42828 14.4496 9.79591 14.3788C12.6746 13.4179 14.75 10.7025 14.75 7.50024C14.75 3.49593 11.5036 0.25 7.49933 0.25Z"
              fill="currentColor"
              fillRule="evenodd"
              clipRule="evenodd"
            ></path>
          </svg>
          <span>Continue with Github</span>
        </Link>
        <Link
          className="primary-btn flex h-10 items-center justify-center gap-2"
          href="/sms"
        >
          <ChatBubbleOvalLeftEllipsisIcon className="size-6" />
          <span>Continue with SMS</span>
        </Link>
      </div>
    </>
  );
}
```

# 5 SERVER ACTIONS

## 5.0 Route Handlers

ë¡œê·¸ì¸í•  ë•Œ ì´ì „ê¹Œì§€ëŠ” ë°±ì—”ë“œ API /api/login ì„ ì´ìš©í•´ ë¡œê·¸ì¸í–ˆì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë„ ê°€ëŠ¥í•˜ê¸´ í•˜ì§€ë§Œ ë‹¤ë¥¸ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ° ë°©ë²•ì„ API Routeë¼ê³  í•©ë‹ˆë‹¤. í´ë” ì´ë¦„ì€ ìƒê´€ ì—†ê³  route.tsê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.

route handler

ê·¸ë¦¬ê³  NextRequestê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.

ì´ì œ API Routeë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

- app/login/page.tsx

```tsx
"use client";

import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";

export default function LogIn() {
  const onClick = async () => {
    const response = await fetch("/www/users", {
      method: "POST",
      body: JSON.stringify({
        username: "nico",
        password: "1234",
      }),
    });
    console.log(await response.json());
  };
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form className="flex flex-col gap-3">
        <FormInput type="email" placeholder="Email" required errors={[]} />
        <FormInput
          type="password"
          placeholder="Password"
          required
          errors={[]}
        />
      </form>
      <span onClick={onClick}>
        <FormButton loading={false} text="Log in" />
      </span>
      <SocialLogin />
    </div>
  );
}
```

- www/users/route.tsx

```tsx
import { NextRequest } from "next/server";

export async function GET(request: NextRequest) {
  console.log(request);
  return Response.json({
    ok: true,
  });
}

export async function POST(request: NextRequest) {
  const data = await request.json();
  console.log("log the user in!!!");
  return Response.json(data);
}
```

## 5.1 Server Actions

formData: FormData!!!!

https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations

https://developer.mozilla.org/en-US/docs/Web/API/FormData#instance_methods

`â€œuse serverâ€` ëŠ” í•­ìƒ ìµœ ìƒë‹¨ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

`<input />` ì—ëŠ” nameì´ í•„ìš”í•©ë‹ˆë‹¤.

`formData.get(â€nameâ€)`

```tsx
async function handleForm(formData: FormData) {
  "use server";
}
```

- app/login/page.tsx

```tsx
import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";

export default function LogIn() {
  async function handleForm(formData: FormData) {
    "use server";
    console.log(formData.get("email"), formData.get("password"));
    console.log("i run in the server baby!");
  }
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form action={handleForm} className="flex flex-col gap-3">
        <FormInput
          name="email"
          type="email"
          placeholder="Email"
          required
          errors={[]}
        />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
          errors={[]}
        />
        <FormButton loading={false} text="Log in" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

- components/form-input.tsx

```tsx
interface FormInputProps {
  type: string;
  placeholder: string;
  required: boolean;
  errors: string[];
  name: string;
}

export default function FormInput({
  type,
  placeholder,
  required,
  errors,
  name,
}: FormInputProps) {
  return (
    <div className="flex flex-col gap-2">
      <input
        name={name}
        className="bg-transparent rounded-md w-full h-10 focus:outline-none ring-2 focus:ring-4 transition ring-neutral-200 focus:ring-orange-500 border-none placeholder:text-neutral-400"
        type={type}
        placeholder={placeholder}
        required={required}
      />
      {errors.map((error, index) => (
        <span key={index} className="text-red-500 font-medium">
          {error}
        </span>
      ))}
    </div>
  );
}
```

## 5.2 useFormStatus

react-hook-form ì‚¬ìš© ì•ˆí•´ë„ ë¨.

useMutation hook ì•ˆí•´ë„ ë¨

ë¡œë”© ë§Œë“œëŠ”ë° í•„ìš”í•œ form status

```tsx
import { useFormStatus } from "react-dom;";
```

- components/form-btn.tsx

```tsx
"use client";

import { useFormStatus } from "react-dom";

interface FormButtonProps {
  text: string;
}

export default function FormButton({ text }: FormButtonProps) {
  const { pending } = useFormStatus();
  return (
    <button
      disabled={pending}
      className="primary-btn h-10 disabled:bg-neutral-400  disabled:text-neutral-300 disabled:cursor-not-allowed"
    >
      {pending ? "ë¡œë”© ì¤‘" : text}
    </button>
  );
}
```

- app/login/page.tsx

```tsx
import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";

export default function LogIn() {
  async function handleForm(formData: FormData) {
    "use server";
    await new Promise((resolve) => setTimeout(resolve, 5000));
    console.log("logged in!");
  }
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form action={handleForm} className="flex flex-col gap-3">
        <FormInput
          name="email"
          type="email"
          placeholder="Email"
          required
          errors={[]}
        />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
          errors={[]}
        />
        <FormButton text="Log in" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

## 5.3 useFormState

- server actionê³¼ useFormState()ì˜ ì¡°í•©
- useActionState()ë¡œ ì´ë¦„ ë°”ë€œ

`const [state, formAction] = useActionState(fn, initialState, permalink?);`

ì´ê±° ì¢€ ì–´ë ¤ì›€.

- app/login/page.tsx

```tsx
"use client";

import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";
import { useFormState } from "react-dom";
import { handleForm } from "./actions";

export default function LogIn() {
  const [state, action] = useFormState(handleForm, null);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form action={action} className="flex flex-col gap-3">
        <FormInput
          name="email"
          type="email"
          placeholder="Email"
          required
          errors={[]}
        />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
          errors={state?.errors ?? []}
        />
        <FormButton text="Log in" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

- app/login/actions.tsx

```tsx
"use server";

export async function handleForm(prevState: any, formData: FormData) {
  console.log(prevState);
  await new Promise((resolve) => setTimeout(resolve, 5000));
  return {
    errors: ["wrong password", "password too short"],
  };
}
```

# 6 VALIDATION

## 6.0 Introduction to Zod

if, if, ifë¥¼ í”¼í•˜ê³  ì‹¶ì–´ìš”. ZodëŠ” ê·¸ê±¸ í•´ê²°í•´ì¤ë‹ˆë‹¤.

ìœ ì €ëŠ” ë¯¿ì„ ìˆ˜ ì—†ì–´ìš”!

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‘ì„±ëœ ì½”ë“œì˜ ì»´íŒŒì¼ ì‹œì ì—ë§Œ íƒ€ì… ê²€ì‚¬ë¥¼ í•˜ë©°, ì´ê²ƒì€ ì˜¤ì§ ê°œë°œìë¥¼ ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.

ì»´íŒŒì¼ì„ í•œ í›„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ë¬´ëŸ° í˜ì„ ì“°ì§€ ëª»í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ zod ì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë„ì›€ì„ ë°›ì•„ì„œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œë„ íƒ€ì… ê²€ì‚¬(ìœ íš¨ì„± ê²€ì¦)ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

https://www.daleseo.com/zod-why-validation/

```tsx
"use server";

import { z } from "zod";

const usernameSchema = z.string().min(5).max(10);

export async function createAccount(prevState: any, formData: FormData) {
  const data = {
    username: formData.get("username"),
    email: formData.get("email"),
    password: formData.get("password"),
    confirm_password: formData.get("confirm_password"),
  };
  usernameSchema.parse(data.username);
}
```

```tsx
"use client";

import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";
import { useFormState } from "react-dom";
import { createAccount } from "./actions";

export default function CreateAccount() {
  const [state, dispatch] = useFormState(createAccount, null);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Fill in the form below to join!</h2>
      </div>
      <form action={dispatch} className="flex flex-col gap-3">
        <FormInput
          name="username"
          type="text"
          placeholder="Username"
          required
        />
        <FormInput name="email" type="email" placeholder="Email" required />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
        />
        <FormInput
          name="confirm_password"
          type="password"
          placeholder="Confirm Password"
          required
        />
        <FormButton text="Create account" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

## 6.1 Validation Errors

[Object Schema]

z.object() ë¡œ ì˜¤ë¸Œì íŠ¸ ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œ: const User = z.object( { username: z.string() } );

[.parse]

dataì˜ íƒ€ì…ì´ ìœ íš¨í•œì§€ ê²€ì‚¬í•˜ê¸° ìœ„í•´ .parse ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ íš¨í•œ ê²½ìš° ë°ì´í„° ì „ì²´ ì •ë³´ê°€ í¬í•¨ëœ ê°’ì´ ë°˜í™˜ë©ë‹ˆë‹¤. ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš°, ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë³´í†µ try-catch ë¬¸ìœ¼ë¡œ ê°ì‹¸ì„œ ì‚¬ìš©í•œë‹¤ê³  í•©ë‹ˆë‹¤.

[.safeParse]

.parseë¥¼ ì‚¬ìš©í•  ë•Œ íƒ€ì…ì´ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° Zodê°€ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ê²ƒì„ ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, .safeParseë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

ë°ì´í„°ê°€ ìœ íš¨í•œ ê²½ìš° trueê°’ì˜ successì™€ ë°ì´í„° ì •ë³´ê°€ ë‹´ê¸´ dataë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” falseê°’ì˜ successì™€ ì—ëŸ¬ ì •ë³´ê°€ ë‹´ê¸´ errorë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ì˜ˆì‹œ : stringSchema.safeParse(12); // => { success: false; error: ZodError }

```tsx
"use server";
import { z } from "zod";

const formSchema = z.object({
  username: z.string().min(3).max(10),
  email: z.string().email(),
  password: z.string().min(10),
  confirm_password: z.string().min(10),
});

export async function createAccount(prevState: any, formData: FormData) {
  const data = {
    username: formData.get("username"),
    email: formData.get("email"),
    password: formData.get("password"),
    confirm_password: formData.get("confirm_password"),
  };
  const result = formSchema.safeParse(data);
  if (!result.success) {
    return result.error.flatten();
  }
}
```

```tsx
"use client";

import FormButton from "@/components/form-btn";
import FormInput from "@/components/form-input";
import SocialLogin from "@/components/social-login";
import { useFormState } from "react-dom";
import { createAccount } from "./actions";

export default function CreateAccount() {
  const [state, dispatch] = useFormState(createAccount, null);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Fill in the form below to join!</h2>
      </div>
      <form action={dispatch} className="flex flex-col gap-3">
        <FormInput
          name="username"
          type="text"
          placeholder="Username"
          required
          errors={state?.fieldErrors.username}
        />
        <FormInput
          name="email"
          type="email"
          placeholder="Email"
          required
          errors={state?.fieldErrors.email}
        />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
          errors={state?.fieldErrors.password}
        />
        <FormInput
          name="confirm_password"
          type="password"
          placeholder="Confirm Password"
          required
          errors={state?.fieldErrors.confirm_password}
        />
        <FormButton text="Create account" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

## 6.2 Refinement

Zodì—ëŠ” ëª‡ ê°€ì§€ ë¬¸ìì—´ ê´€ë ¨ ìœ íš¨ì„± ê²€ì‚¬ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. https://zod.dev/?id=strings

ë¬¸ìì—´ ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“¤ ë•Œ ëª‡ ê°€ì§€ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const name = z.string({
  required_error: "Nameì€ í•„ìˆ˜ì…ë‹ˆë‹¤.",
  invalid_type_error: "Nameì€ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.",
});
```

ìœ íš¨ì„± ê²€ì‚¬ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ë•Œ ì¶”ê°€ ì¸ìˆ˜ë¥¼ ì „ë‹¬í•˜ì—¬ ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`z.string().min(5, { message: "5ê¸€ì ì´ìƒ ë˜ì–´ì•¼í•©ë‹ˆë‹¤." });`

.refine ë©”ì„œë“œë¥¼ í†µí•´ ì‚¬ìš©ì ì§€ì • ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. https://zod.dev/?id=refine

`z.string().refine((val) â‡’ val.length â‰¤ 255, {message: â€œ255ì´í•˜ì˜ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.â€});`

.refine ì€ 2ê°œì˜ ì¸ìˆ˜ë¥¼ ë°›ìŠµë‹ˆë‹¤.

1. ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜

2. ëª‡ê°€ì§€ ì˜µì…˜

ì œê³µë˜ëŠ” ì˜µì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- message: ì—ëŸ¬ ë©”ì„¸ì§€ ì§€ì •
- path: ì—ëŸ¬ ê²½ë¡œ ì§€ì •
- params: ì—ëŸ¬ì‹œ ë©”ì„¸ì§€ë¥¼ ì»¤ìŠ¤í…€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê°ì²´

```tsx
"use server";
import { z } from "zod";

const formSchema = z
  .object({
    username: z
      .string({
        invalid_type_error: "Username must be a string!",
        required_error: "Where is my username???",
      })
      .min(3, "Way too short!!!")
      .max(10, "That is too looooong!")
      .refine(
        (username) => !username.includes("potato"),
        "No potatoes allowed!"
      ),
    email: z.string().email(),
    password: z.string().min(10),
    confirm_password: z.string().min(10),
  })
  .superRefine(({ password, confirm_password }, ctx) => {
    if (password !== confirm_password) {
      ctx.addIssue({
        code: "custom",
        message: "Two passwords should be equal",
        path: ["confirm_password"],
      });
    }
  });
```

## 6.3 Transformation

// At least one uppercase letter, one lowercase letter, one number and one special character

```tsx
const passwordRegex = new RegExp(
  /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).+$/
);
```

[.regax]

ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ë°ì´í„° ê²€ì¦ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[.toLowerCase]

String íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ì†Œë¬¸ìë¡œ ë³€í™˜í•´ì¤ë‹ˆë‹¤.

[.trim]

String íƒ€ì…ì˜ ë°ì´í„°ì—ì„œ ë§¨ì•ê³¼ ë’¤ì— ë¶™ì€ ê³µë°±ì„ ì œê±°í•´ì¤ë‹ˆë‹¤.

[.transform]

ì´ ë©”ì„œë“œë¥¼ ì´ìš©í•˜ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œ: `.transform((username) => `ğŸ”¥ ${username} ğŸ”¥`)`

```tsx
"use server";
import { z } from "zod";

const passwordRegex = new RegExp(
  /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*?[#?!@$%^&*-]).+$/
);

const formSchema = z
  .object({
    username: z
      .string({
        invalid_type_error: "Username must be a string!",
        required_error: "Where is my username???",
      })
      .min(3, "Way too short!!!")
      //.max(10, "That is too looooong!")
      .trim()
      .toLowerCase()
      .transform((username) => `ğŸ”¥ ${username}`)
      .refine(
        (username) => !username.includes("potato"),
        "No potatoes allowed!"
      ),
    email: z.string().email().toLowerCase(),
    password: z
      .string()
      .min(4)
      .regex(
        passwordRegex,
        "Passwords must contain at least one UPPERCASE, lowercase, number and special characters #?!@$%^&*-"
      ),
    confirm_password: z.string().min(4),
  })
  .superRefine(({ password, confirm_password }, ctx) => {
    if (password !== confirm_password) {
      ctx.addIssue({
        code: "custom",
        message: "Two passwords should be equal",
        path: ["confirm_password"],
      });
    }
  });
export async function createAccount(prevState: any, formData: FormData) {
  const data = {
    username: formData.get("username"),
    email: formData.get("email"),
    password: formData.get("password"),
    confirm_password: formData.get("confirm_password"),
  };
  const result = formSchema.safeParse(data);
  if (!result.success) {
    return result.error.flatten();
  } else {
    console.log(result.data);
  }
}
```

## 6.4 Refactor

1. ì¸í„°ì„¹ì…˜ íƒ€ì…ì„ ì´ìš©í•˜ì—¬ input íƒœê·¸ì— ìˆëŠ” ê¸°ë³¸ ì†ì„±ë“¤ì„ propsë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

2. ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ êµ¬ì¡° ë¶„í•´ í• ë‹¹ê³¼ Spread ì—°ì‚°ìë¥¼ ì´ìš©í•˜ì—¬ ë¦¬íŒ©í† ë§ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

=> ì´ì œ ì»¤ìŠ¤í…€ Input ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œ ì›ë˜ input íƒœê·¸ì— ìˆë˜ ê¸°ë³¸ ì†ì„±ì„ ììœ ë¡­ê²Œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
import { InputHTMLAttributes } from "react";

interface InputProps {
  name: string;
  errors?: string[];
}

export default function Input({
  name,
  errors = [],
  ...rest
}: InputProps & InputHTMLAttributes<HTMLInputElement>) {
  console.log(rest);
  return (
    <div className="flex flex-col gap-2">
      <input
        name={name}
        className="bg-transparent rounded-md w-full h-10 focus:outline-none ring-2 focus:ring-4 transition ring-neutral-200 focus:ring-orange-500 border-none placeholder:text-neutral-400"
        {...rest}
      />
      {errors.map((error, index) => (
        <span key={index} className="text-red-500 font-medium">
          {error}
        </span>
      ))}
    </div>
  );
}
```

## 6.5 Recap

[ğŸ”¥ Super Recap ğŸ”¥]

1. inputì— nameì„ ë„£ì–´ì£¼ì–´ì•¼ formDataì—ì„œ getìœ¼ë¡œ í•´ë‹¹ ë°ì´í„° ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. safeParseëŠ” ìŠ¤í‚¤ë§ˆì— ë”°ë¼ ë°ì´í„°ë¥¼ ê²€ì‚¬í•˜ê³  ë³€í˜•ì‹œì¼œì¤ë‹ˆë‹¤.

3. .refineìœ¼ë¡œ ì»¤ìŠ¤í…€ validationì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

objectìì²´ì— refineì„ í•´ì£¼ë©´ ê°ì²´ ì•ˆì— ìˆëŠ” ì „ì²´ ë°ì´í„°ë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4. .transformìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³€í˜•ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

5. safeParseëŠ” parseì™€ ë‹¤ë¥´ê²Œ ê²€ì¦ì— ì‹¤íŒ¨í•´ë„ ì—ëŸ¬ë¥¼ ë§Œë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤.

6. ì—ëŸ¬ ê°ì²´ì— flatten ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©í•˜ê¸° ì‰½ê²Œ í¬ë§·íŒ…ë©ë‹ˆë‹¤.

7. ê²€ì¦ ì„±ê³µì‹œ ì›ë³¸ dataë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  result.dataë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.

## 6.6 Log In Validation

1. ìƒìˆ˜ ë¶„ë¦¬
2. Login validation

```tsx
"use server";

import {
  PASSWORD_MIN_LENGTH,
  PASSWORD_REGEX,
  PASSWORD_REGEX_ERROR,
} from "@/lib/constants";
import { z } from "zod";

const formSchema = z.object({
  email: z.string().email().toLowerCase(),
  password: z
    .string({
      required_error: "Password is required",
    })
    .min(PASSWORD_MIN_LENGTH)
    .regex(PASSWORD_REGEX, PASSWORD_REGEX_ERROR),
});

export async function logIn(prevState: any, formData: FormData) {
  const data = {
    email: formData.get("email"),
    password: formData.get("password"),
  };
  const result = formSchema.safeParse(data);
  if (!result.success) {
    console.log(result.error.flatten());
    return result.error.flatten();
  } else {
    console.log(result.data);
  }
}
```

```tsx
"use client";

import FormButton from "@/components/button";
import FormInput from "@/components/input";
import SocialLogin from "@/components/social-login";
import { useFormState } from "react-dom";
import { logIn } from "./actions";
import { PASSWORD_MIN_LENGTH } from "@/lib/constants";

export default function LogIn() {
  const [state, dispatch] = useFormState(logIn, null);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">ì•ˆë…•í•˜ì„¸ìš”!</h1>
        <h2 className="text-xl">Log in with email and password.</h2>
      </div>
      <form action={dispatch} className="flex flex-col gap-3">
        <FormInput
          name="email"
          type="email"
          placeholder="Email"
          required
          errors={state?.fieldErrors.email}
        />
        <FormInput
          name="password"
          type="password"
          placeholder="Password"
          required
          minLength={PASSWORD_MIN_LENGTH}
          errors={state?.fieldErrors.password}
        />
        <FormButton text="Log in" />
      </form>
      <SocialLogin />
    </div>
  );
}
```

## 6.7 Coerce

- ê°’ ë³€í™˜: transform()
- íƒ€ì… ê°•ì œ ë³€í™˜: coerce()

[Coerce]

ZodëŠ” coerceë¥¼ ì´ìš©í•˜ì—¬ ê°’ì˜ íƒ€ì…ì„ ê°•ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ëª¨ë“  ì›ì‹œ íƒ€ì…ì´ ì§€ì›ë˜ë©°, ì•„ë˜ì™€ ê°™ì´ ì‘ë™ë©ë‹ˆë‹¤.

z.coerce.string(); // String(input)

z.coerce.number(); // Number(input)

z.coerce.boolean(); // Boolean(input)

z.coerce.bigint(); // BigInt(input)

z.coerce.date(); // new Date(input)

[Validator]

JavaScriptì˜ validator ëª¨ë“ˆì€ ë¬¸ìì—´ ê²€ì¦ ë° ì‚´ê· (sanitization)ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ì–‘í•œ ìœ í˜•ì˜ ë¬¸ìì—´ ì…ë ¥ì„ ê²€ì¦í•˜ê±°ë‚˜ ì‚´ê· í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì´ë©”ì¼ ì£¼ì†Œê°€ ìœ íš¨í•œ í˜•ì‹ì¸ì§€, ë¬¸ìì—´ì´ íŠ¹ì • í˜•ì‹(ì˜ˆ: URL, ë‚ ì§œ)ì— ë§ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì…ë ¥ìœ¼ë¡œë¶€í„° HTML íƒœê·¸ë¥¼ ì œê±°í•˜ëŠ” ë“±ì˜ ì‚´ê·  ì‘ì—…ë„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
npm i validator
npm i @types/validator
```

validatorë¬¸ìì—´ ìœ íš¨ì„± ê²€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

npm i validator

https://www.npmjs.com/package/validator

```tsx
"use server";

import { z } from "zod";
import validator from "validator";

const phoneSchema = z.string().trim().refine(validator.isMobilePhone);

const tokenSchema = z.coerce.number().min(100000).max(999999);

export async function smsLogIn(prevState: any, formData: FormData) {
  console.log(formData.get("token"));
  console.log(tokenSchema.parse(formData.get("token")));
}
```

```tsx
"use client";

import Button from "@/components/button";
import Input from "@/components/input";
import { useFormState } from "react-dom";
import { smsLogIn } from "./actions";

export default function SMSLogin() {
  const [state, dispatch] = useFormState(smsLogIn, null);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">SMS Log in</h1>
        <h2 className="text-xl">Verify your phone number.</h2>
      </div>
      <form action={dispatch} className="flex flex-col gap-3">
        <Input name="phone" type="number" placeholder="Phone number" required />
        <Input
          name="token"
          type="number"
          placeholder="Verification code"
          required
          min={100000}
          max={999999}
        />
        <Button text="Verify" />
      </form>
    </div>
  );
}
```

## 6.8 SMS Validation

Inputì— keyê°€ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ë‚˜ë³´ë‹¤.

https://react.dev/learn/rendering-lists

```tsx
import { z } from "zod";
import validator from "validator";
import { redirect } from "next/navigation";

const phoneSchema = z
  .string()
  .trim()
  .refine(
    (phone) => validator.isMobilePhone(phone, "ko-KR"),
    "Wrong phone format"
  );

const tokenSchema = z.coerce.number().min(100000).max(999999);

interface ActionState {
  token: boolean;
}

export async function smsLogIn(prevState: ActionState, formData: FormData) {
  const phone = formData.get("phone");
  const token = formData.get("token");
  if (!prevState.token) {
    const result = phoneSchema.safeParse(phone);
    if (!result.success) {
      return {
        token: false,
        error: result.error.flatten(),
      };
    } else {
      return {
        token: true,
      };
    }
  } else {
    const result = tokenSchema.safeParse(token);
    if (!result.success) {
      return {
        token: true,
        error: result.error.flatten(),
      };
    } else {
      redirect("/");
    }
  }
}
```

```tsx
"use client";

import Button from "@/components/button";
import Input from "@/components/input";
import { useFormState } from "react-dom";
import { smsLogIn } from "./actions";

const initialState = {
  token: false,
  error: undefined,
};

export default function SMSLogin() {
  const [state, dispatch] = useFormState(smsLogIn, initialState);
  return (
    <div className="flex flex-col gap-10 py-8 px-6">
      <div className="flex flex-col gap-2 *:font-medium">
        <h1 className="text-2xl">SMS Log in</h1>
        <h2 className="text-xl">Verify your phone number.</h2>
      </div>
      <form action={dispatch} className="flex flex-col gap-3">
        {state.token ? (
          <Input
            key="token"
            name="token"
            type="number"
            placeholder="Verification code"
            required
            min={100000}
            max={999999}
          />
        ) : (
          <Input
            key="phone"
            name="phone"
            type="text"
            placeholder="Phone number"
            required
            errors={state.error?.formErrors}
          />
        )}
        <Button text={state.token ? "Verify Token" : "Send Verification SMS"} />
      </form>
    </div>
  );
}
```

# 7 PRISMA

## 7.0 Setup

PrismsëŠ” DB

Prismaì—ê²Œ Prisma Scheme Languageë¡œ ë‚´ ë°ì´í„° êµ¬ì¡°ë¥¼ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ PrismaëŠ” SQLì„ ìƒì„±í•©ë‹ˆë‹¤.

Prisma Client, TypeScript, ORM

ë§ˆì´ê·¸ë ˆì´ì…˜ë„ ëŒ

Database Browserë„ ë¨

PrismaëŠ” í†µì—­ì‚¬

ì°¨ì„¸ëŒ€ Node.js ë° TypeScript ORM

https://www.prisma.io/orm

prisma ì´ˆê¸°í™”

```bash
npx prisma init
```

## 7.1 Schemas

ì´ˆê¸°í™” í•˜ë©´ ì•„ë˜ íŒŒì¼ì´ ìƒì„±ë˜ëŠ”ë° ORMì„ ì¶”ê°€í•´ì¤ì‹œë‹¤.

- prisma/schema.prisma

```
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())
  username String @unique
  email String? @unique
  password String?
  phone String? @unique
  github_id String? @unique
  avatar String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}
```

ê·¸ë¦¬ê³  ì•„ë˜ ëª…ë ¹ì„ ì…ë ¥í•˜ë©´ DBê°€ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

```bash
npx prisma migrate dev
add_user
```

## 7.2 Prisma Client

Prisma ClientëŠ” ë°ì´í„°ì— ë§ì¶° ìë™ ìƒì„±ë˜ëŠ” type-safe ì¿¼ë¦¬ ë¹Œë”ì…ë‹ˆë‹¤.

```bash
// Installation
npm install @prisma/client
```

PrismaëŠ” schema.prismaë¥¼ ë³´ê³  d.tsíŒŒì¼ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

- lib/db.ts

```tsx
import { PrismaClient } from "@prisma/client";

const db = new PrismaClient();

export async function test() {
  const users = await db.user.findMany({
    where: {
      username: {
        contains: "est",
      },
    },
  });
  console.log(users);
  //   const user = await db.user.create({
  //     data: {
  //       username: "test",
  //     },
  //   });
  //   console.log(user);
}

export default db;
```

// Importing Prisma Client

`import { PrismaClient } from '@prisma/client'`

`const prisma = new PrismaClient()`

https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/introduction

npx prisma migrate dev ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì˜ ê³¼ì •ì´ í•œë²ˆì— ìˆ˜í–‰ë©ë‹ˆë‹¤.

1. ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•˜ê³ , ìˆ˜ì •ë˜ì—ˆê±°ë‚˜ ì‚­ì œëœ ë¶€ë¶„ì„ ì°¾ìŠµë‹ˆë‹¤.

2. ìƒˆë¡œìš´ ë³€ê²½ ì‚¬í•­ì´ ìˆë‹¤ë©´, ê·¸ê²ƒì„ ì‹œí—˜í•´ ë³¼ ìˆ˜ ìˆëŠ” ë³„ë„ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ë¨¼ì € ì ìš©í•©ë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ëª©ì )

3. ë°ì´í„° ëª¨ë¸ì— ë³€í™”ê°€ ìˆìœ¼ë©´, ê·¸ì— ë§ëŠ” ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë§Œë“­ë‹ˆë‹¤.

4. ëª¨ë“  ìƒˆë¡œìš´ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ìš©í•˜ê³ , ì´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

5. í•„ìš”í•œ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. (Prisma Client ë“±..)

ë” ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ë¥¼ í†µí•´ ê³µë¶€í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[migrate workflows ê³µì‹ ë¬¸ì„œ]

https://www.prisma.io/docs/orm/prisma-migrate/workflows/development-and-production

[migrate workflowsì— ëŒ€í•´ í•œê¸€ë¡œ ì •ë¦¬ëœ ë¸”ë¡œê·¸]

https://pyh.netlify.app/prisma/prisma_migrate/

## 7.3 Prisma Studio

Django adminê°™ì€ ê²ƒ

Prisma Studio

Prisma í”„ë¡œì íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ê³  ì¡°ì‘í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì…ë‹ˆë‹¤.

```bash
npx prisma studio
```

https://www.prisma.io/studio

Schemaë³€ê²½ì‹œ â†’ prisma studio ì¢…ë£Œ â†’ migrate â†’ ë‹¤ì‹œ ì‹¤í–‰

## 7.4 Relationships

Userì™€ SMSTokenì„ ì—°ê²°í•˜ë©´ì„œ Relationì„ ë°°ìš¸ê²ë‹ˆë‹¤.

```
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         Int        @id @default(autoincrement())
  username   String     @unique
  email      String?    @unique
  password   String?
  phone      String?    @unique
  github_id  String?    @unique
  avatar     String?
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  SMSToken   SMSToken[]
}

model SMSToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])
  userId     Int
}

```

```tsx
import { PrismaClient } from "@prisma/client";

const db = new PrismaClient();

export async function test() {
  const token = await db.sMSToken.findUnique({
    where: {
      id: 1,
    },
  });
  console.log(token);
}

export default db;
```

## 7.5 onDelete

Userì™€ tokenì´ ê´€ê³„ë§ºê³  ìˆê¸° ë•Œë¬¸ì— userë¥¼ ì§€ìš¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

```
model SMSToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     Int
}
```

onDeleteë¥¼ ì •í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ì—°ê´€ëœ ê°ì²´ë¥¼ ì§€ìš°ëŠ”ê²Œ ê¼­ í•„ìš”í•œ ì¼ì¸ì§€ë„ ìƒê°í•´ë´ì•¼í•©ë‹ˆë‹¤.

# 8 AUTHENTICATION

## 8.1 Database Validation

z.refine(fn)ì—ì„œ fnì€ booleanì„ reuturní•´ì•¼ í•©ë‹ˆë‹¤.

dbì— usernameê³¼ emailì´ uniqueì¸ì§€ í™•ì¸í•˜ê³  ìˆìœ¼ë©´ ì§„í–‰, ì—†ìœ¼ë©´ ì—ëŸ¬ ë°œìƒ.

í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ê³ , z.refineê³¼ ì¡°í•© ê°€ëŠ¥

`const result = await formSchema.safeParseAsync(data);`

async, awaitì— ìœ ì˜

Booleanì‚¬ìš©

- app/create-account/action.ts

```tsx
"use server";
import {
  PASSWORD_MIN_LENGTH,
  PASSWORD_REGEX,
  PASSWORD_REGEX_ERROR,
} from "@/lib/constants";
import db from "@/lib/db";
import { z } from "zod";

const checkUsername = (username: string) => !username.includes("potato");
const checkPasswords = ({
  password,
  confirm_password,
}: {
  password: string;
  confirm_password: string;
}) => password === confirm_password;

const checkUniqueUsername = async (username: string) => {
  const user = await db.user.findUnique({
    where: {
      username,
    },
    select: {
      id: true,
    },
  });
  // if (user) {
  //   return false;
  // } else {
  //   return true;
  // }
  return !Boolean(user);
};

const checkUniqueEmail = async (email: string) => {
  const user = await db.user.findUnique({
    where: {
      email,
    },
    select: {
      id: true,
    },
  });
  return Boolean(user) === false;
};

const formSchema = z
  .object({
    username: z
      .string({
        invalid_type_error: "Username must be a string!",
        required_error: "Where is my username???",
      })
      .toLowerCase()
      .trim()
      // .transform((username) => `ğŸ”¥ ${username} ğŸ”¥`)
      .refine(checkUsername, "No potatoes allowed!")
      .refine(checkUniqueUsername, "This username is already taken"),
    email: z
      .string()
      .email()
      .toLowerCase()
      .refine(
        checkUniqueEmail,
        "There is an account already registered with that email."
      ),
    password: z.string().min(PASSWORD_MIN_LENGTH),
    //.regex(PASSWORD_REGEX, PASSWORD_REGEX_ERROR),
    confirm_password: z.string().min(PASSWORD_MIN_LENGTH),
  })
  .refine(checkPasswords, {
    message: "Both passwords should be the same!",
    path: ["confirm_password"],
  });
export async function createAccount(prevState: any, formData: FormData) {
  const data = {
    username: formData.get("username"),
    email: formData.get("email"),
    password: formData.get("password"),
    confirm_password: formData.get("confirm_password"),
  };
  const result = await formSchema.safeParseAsync(data);
  if (!result.success) {
    return result.error.flatten();
  } else {
    // hash password
    // save the user to db
    // log the user in
    // redirect "/home"
  }
}
```

## 8.2 Password Hashing

bcrypt

```tsx
npm i bcrypt
npm i -D @types/bcrypt
```

How To Safely Store A Password?

https://codahale.com/how-to-safely-store-a-password/

hashing, salting, rainbow

https://youtu.be/67UwxR3ts2E?si=2pqx4IUADxyAzoUj

hash function is one way

how many times do you want to hash? 12 times

```tsx
const hashedPassword = await bcrypt.hash(result.data.password, 12);
```

why do we select only id?

- app/create-account/action.ts

```tsx
export async function createAccount(prevState: any, formData: FormData) {
  const data = {
    username: formData.get("username"),
    email: formData.get("email"),
    password: formData.get("password"),
    confirm_password: formData.get("confirm_password"),
  };
  const result = await formSchema.safeParseAsync(data);
  if (!result.success) {
    return result.error.flatten();
  } else {
    const hashedPassword = await bcrypt.hash(result.data.password, 12);
    const user = await db.user.create({
      data: {
        username: result.data.username,
        email: result.data.email,
        password: hashedPassword,
      },
      select: {
        id: true,
      },
    });
    // log the user in
    // redirect "/home"
  }
}
```

## 8.3 Iron Session

Is user logged in or not?

ì¿ í‚¤ëŠ” ëª¨ë“  ìš”ì²­ì— ë“¤ì–´ê°€ì„œ ëˆ„ê°€ ìš”ì²­í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆì–´ìš”

password: process.env.COOKIE_PASSWORD!

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ê²Œ ì´ ê°’ì´ ë¬´ì¡°ê±´ ìˆë‹¤ê³  ì•Œë ¤ì¤„ ìˆ˜ ìˆìŒ

### app/create-account/action.ts

```
    const cookie = await getIronSession<typeof user>(cookies(), {
      cookieName: "delicious-karrot",
      password: process.env.COOKIE_PASSWORD!,
    });
    cookie.id = user.id;
    await cookie.save();
    redirect("/profile");
```

### tips

ë¹„ë°€ë²ˆí˜¸ í„¸ë ¸ë‹¤ê³ ? ì•”í˜¸í™”. í•´ì‹œí•¨ìˆ˜. 5ë¶„ ì„¤ëª….

https://www.youtube.com/watch?v=67UwxR3ts2E

ì„¸ì…˜ vs í† í° vs ì¿ í‚¤? ê¸°ì´ˆê°œë… ì¡ì•„ë“œë¦¼. 10ë¶„ ìˆœì‚­!

https://www.youtube.com/watch?v=tosLBcAX1vk

1password password generator

https://1password.com/password-generator/

For generating random 32 character-long password, you may just use terminal command as Next.js documentation introduced:

`openssl rand -base64 32`

https://nextjs.org/docs/app/building-your-application/authentication#1-generating-a-secret-key

### iron-session

```tsx
npm i iron-session
```

## 8.4 Recap

## 8.5 Email Log In

login session êµ¬í˜„

const result = await formSchema.spa(data); â†’ safeParseAsync

zodì™€ bcryptì—ì„œ ë‘ë²ˆ dbì ‘ê·¼

user!.id; â†’ if you know that user exist!!!

- lib/sessions.ts

```tsx
import { getIronSession } from "iron-session";
import { cookies } from "next/headers";

interface SessionContent {
  id?: number;
}

export default function getSession() {
  return getIronSession<SessionContent>(cookies(), {
    cookieName: "delicious-karrot",
    password: process.env.COOKIE_PASSWORD!,
  });
}
```

- app/login/action.ts

```tsx
"use server";

import bcrypt from "bcrypt";
import {
  PASSWORD_MIN_LENGTH,
  PASSWORD_REGEX,
  PASSWORD_REGEX_ERROR,
} from "@/lib/constants";
import db from "@/lib/db";
import { z } from "zod";
import getSession from "@/lib/session";
import { redirect } from "next/navigation";

const checkEmailExists = async (email: string) => {
  const user = await db.user.findUnique({
    where: {
      email,
    },
    select: {
      id: true,
    },
  });
  // if(user){
  //   return true
  // } else {
  //   return false
  // }
  return Boolean(user);
};

const formSchema = z.object({
  email: z
    .string()
    .email()
    .toLowerCase()
    .refine(checkEmailExists, "An account with this email does not exist."),
  password: z.string({
    required_error: "Password is required",
  }),
  // .min(PASSWORD_MIN_LENGTH),
  // .regex(PASSWORD_REGEX, PASSWORD_REGEX_ERROR),
});

export async function logIn(prevState: any, formData: FormData) {
  const data = {
    email: formData.get("email"),
    password: formData.get("password"),
  };
  const result = await formSchema.spa(data);
  if (!result.success) {
    return result.error.flatten();
  } else {
    const user = await db.user.findUnique({
      where: {
        email: result.data.email,
      },
      select: {
        id: true,
        password: true,
      },
    });
    const ok = await bcrypt.compare(
      result.data.password,
      user!.password ?? "xxxx"
    );
    if (ok) {
      const session = await getSession();
      session.id = user!.id;
      redirect("/profile");
    } else {
      return {
        fieldErrors: {
          password: ["Wrong password."],
          email: [],
        },
      };
    }
  }
}
```
